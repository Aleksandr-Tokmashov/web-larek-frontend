# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Данные о товаре

```
export interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number
}
```

Список товаров

```
export interface IProductList {
  total: number;
  items: IProduct[]
}

```

Интерфейс для модели данных карточек

```
export interface ICardsData {
  items: IProduct[];
  preview: string | null;
} 
```

Данные пользователя
```
export interface IInputs {
  payment: string;
  address: string;
  email: string;
  phone: string;
}
```

Данные заказа
```
export interface IOrder extends IInputs {
  total: number;
  items: string[];
}

Ответ сервера при совершении заказа 
```
export interface IOrderResult {
  id: string;
  total: number;
}
```

Интерфейс модели данных заказа
```
export interface IOrderData {
  clearData(): void;
  getData(): IOrder;
  setItems(products: IProduct[]): void;
  setField(field: keyof IInputs, value: string): void;
  validateOrder(): boolean;
  checkField(value: string): boolean;
}
```

Корзина

```
export interface IBasketData {
  items: IProduct[];
  totalPrice: number;
  addProduct(product: IProduct): void;
  deleteProduct(id: string): void;
  clearBasket(): void;
}
```

Данные карточек, отображаемых на странице

```
export type TCard = Omit<IProduct, '_id' | 'description'>;
```


Данные о способе оплаты и адресе пользователя

```
export type TPayment = Pick<IInputs, 'payment' | 'address'>;
```

Данные об электронной почте и телефоне пользователя

```
export type TContacts = Pick<IInputs, 'email' | 'phone'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
- constructor(baseUrl: string, options: RequestInit = {}) - конструктор принимает URL и параметры для подключения
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с каталогом карточек товаров.\
- constructor(events: IEvents) - Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _items: IProduct[]; - массив объектов карточек товаров
- _preview: string | null - id карточки, выбранной для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
Так же класс предоставляет набор методов для взаимодействия с этими данными:
- getCard(cardId: string): IProduct - возвращает товар по переданному id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными заказа.\
- constructor(events: IEvents) - Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- payment: string - способ оплаты
- address: string - адрес
- email: string - электронная почта
- phone: string - телефон
- total: number - сумма заказа
- items: string[] - список с id товаров заказа
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- clearData(): void - очищает данные
- getData(): IOrder - возвращает данные о заказе
- setItems(products: IProduct[]): void - устанавливает список товаров заказа
- setField(field: keyof IInputs, value: string): void - устанавливает данные пользователя
- getField(field: keyof IInputs) - возвращает данные пользователя по названию поля
- validateContacts(): boolean - проверяет введенные контакты на корректность
- validateOrder(): boolean - проверяет введенные способ оплаты и адрес на корректность
- checkValidation(data: TPayment | TContacts): boolean - проверяет данные пользователя на валидность
- checkField(value: string): boolean - метод определяет валидность одного из свойств данных пользователя

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными карточек в корзине.\
- constructor(events: IEvents) - Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _items: IProduct[] - список товаров в корзине
- totalPrice: number - сумма товаров в корзине
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addProduct(product: IProduct): void - добавляет товар в корзину
- deleteProduct(id: string): void; - удаляет товар из корзины
- clearBasket(): void; - очищает корзину
- сalculateTotalPrice(): void - устанавливает сумму товаров в корзине
- checkProductsPrice(): boolean - проверка на сумму товаров в корзине
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте .
- constructor(protected readonly container: HTMLElement) - принимает элемент разметки, являющийся основным родительским контейнером компонента
- render(data?: Partial<T>): HTMLElement - отвечает за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(container: HTMLElement, events: IEvents) Конструктор принимает содержимое модального окна в виде HTML-элемента и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _closeButton: HTMLButtonElement; - кнопка закрытия модального окна
- _content: HTMLElement - содержимое модального окна
- events: IEvents - брокер событий

- set content(value: HTMLElement): void - сеттер для установки содержимого модального окна

#### Класс Card
Абстрактный класс, служит для создания дочерних классов, отвечающих за отображение карточки, задавая в карточке данные названия, изображения, категории товара, цены, описания. Класс используется для отображения карточек на странице сайта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. \
- constructor(protected container: HTMLTemplateElement, events: IEvents) - В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки и экземпляр класса `EventEmitter`
Методы:
- render(cardData: Partial<IProduct>): HTMLElement - расширяет родительский метод, делая параметр cardData обязательным. Заполняет атрибуты элементов карточки данными Метод возвращает разметку карточки с установленными слушателями. Слушатели устанавливаются на все интерактивные элементы карточки и генерируют соответствующие события через экземпляр брокера событий.
- deleteCard(): void - удаляет карточку из контейнера
- а так-же сеттеры и геттеры для сохранения и получения элементов разметки карточки

#### Класс CardWithImageAndCategory 
Дочерний класс Card, служит для отображения карточки, которая содержит картинку и категорию
- constructor(protected container: HTMLTemplateElement, events: IEvents) - В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки и экземпляр класса `EventEmitter`

#### Класс CardInCatalog
Дочерний класс CardWithImageAndCategory , служит для отображения карточки в каталоге товаров
- constructor(protected container: HTMLTemplateElement, events: IEvents) - В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки и экземпляр класса `EventEmitter`

#### Класс CardPreview
Дочерний класс CardWithImageAndCategory , служит для отображения модального окна с карточкой
- constructor(protected container: HTMLTemplateElement, events: IEvents) - В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки и экземпляр класса `EventEmitter`

#### Класс CardInBasket
Дочерний класс Card, служит для отображения карточки в корзине товаров
- constructor(protected container: HTMLTemplateElement, events: IEvents) - В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки и экземпляр класса `EventEmitter`

#### Класс Basket
Отвечает за отображение корзины. 
- constructor(container: HTMLElement, events: IEvents) Конструктор принимает содержимое модального окна в виде HTML-элемента и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- orderButton: HTMLButtonElement; - кнопка перехода к покупке
- _totalPrice: HTMLElement - сумма заказа
- basketList_items: HTMLElement[] - список с карточками товаров
- basketList: HTMLUListElement - контейнер для карточек товаров
- events: IEvents - брокер событий
Класс также содержи так-же сеттеры и геттеры для сохранения и получения элементов разметки корзины

#### Класс Page
Отвечает за отображение кнопки корзины и  блока с карточками на главной странице. 
- constructor(container: HTMLElement, events: IEvents) Конструктор принимает содержимое модального окна в виде HTML-элемента и экземпляр класса `EventEmitter` для возможности инициации событий.
В метод render принимает массив элементов разметки карточек, который отображает в контейнере, за который отвечает.
- а так-же сеттеры и геттеры для сохранения и получения элементов разметки страницы

#### Класс Form 
Абстрактный класс, служит для создания дочерних классов, отвечающих за отображение фори. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки.\
- constructor(protected container: HTMLTemplateElement, events: IEvents) - В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки и экземпляр класса `EventEmitter`
Методы:
- getInputValues(): Record<string, string> - возвращает название и значение инпутов формы
- showInputError(errorMessage: string): void - отображает поле ошибки формы
- hideInputError(): void скрывает поле ошибки формы
- а так-же сеттеры и геттеры для сохранения и получения элементов разметки формы

#### Класс OrderForm
Дочерний класс Form, служит для отображения формы ввода способа оплаты и адреса
- constructor(protected container: HTMLTemplateElement, events: IEvents) - В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки и экземпляр класса `EventEmitter`
Методы:
- changePayment(): void - изменяет класс кнопок выбора способа оплаты

#### Класс ContactsForm
Дочерний класс Form, служит для отображения формы ввода контактов
- constructor(protected container: HTMLTemplateElement, events: IEvents) - В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки и экземпляр класса `EventEmitter`

#### Класс Success
Отвечает за отображение модального окна с сообщением об успешной покупке. 
- constructor(container: HTMLElement, events: IEvents) Конструктор принимает содержимое модального окна в виде HTML-элемента и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- _successDescription: HTMLElement - элемент с текстом сообщения
- successButton: HTMLButtonElement - кнопка "За новыми покупками"
- events: IEvents; - экземпляр класса `EventEmitter`
Сеттер set successDescription(totalPrice: number) - устанаваливает содержимое элемента с текстом сообщения

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `order:changed` - изменение данных заказа
- `cards:changed` - изменение массива карточек
- `card:selected` - изменение открываемой в модальном окне картинки карточки
- `card:previewClear` - необходима очистка данных выбранной для показа в модальном окне карточки
- `products:changed` - изменение списка продуктов в корзине
- `price:changed` - изменение цены заказа

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:open` - открытие модального окна с корзиной
- `orderForm:open` - открытие модального окна с формой адреса и способа оплаты
- `contactsForm:open` - открытие модального окна с контактами
- `success:open` - открытие модального окна с сообщением об оформлении заказа
- `success:сlose` - открытие модального окна с сообщением об оформлении заказа
- `card:select` - выбор карточки для отображения в модальном окне
- `product:select` - добавление товара в корзину
- `remove-product:submit` - удаление товара из корзины
- `order:input` - изменение данных в форме адреса и способа оплаты
- `contacts:input` - изменение данных в форме контактов
- `order:submit` - сохранение адреса и способа оплаты в модальном окне
- `contacts:submit` - сохранение контактов пользователя в модальном окне